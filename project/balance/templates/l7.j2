upstream wordpress-l7 {
  zone wordpress-l7 1M;
#  least_conn;
  {% for host in groups['backend'] %} 
  server {{ host }}:443;
  {% endfor %}
}

server {
    listen 443 ssl reuseport;
    ssl_certificate /opt/ssl.crt;
    ssl_certificate_key /opt/ssl.key;
    status_zone wordpress-l7;
    access_log /var/log/angie/l7.access.log extended;
    error_log /var/log/angie/l7.error.log error;
    
    location / {
      proxy_set_header Host $host;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_pass https://wordpress-l7;
    }
}